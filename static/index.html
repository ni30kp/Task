<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üèóÔ∏è Donizo Semantic Pricing Engine</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: #333;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        text-align: center;
        color: white;
        margin-bottom: 40px;
      }

      .header h1 {
        font-size: 3rem;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .header p {
        font-size: 1.2rem;
        opacity: 0.9;
      }

      .card {
        background: white;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
      }

      .card:hover {
        transform: translateY(-5px);
      }

      .card h2 {
        color: #667eea;
        margin-bottom: 20px;
        font-size: 1.8rem;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #555;
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e1e5e9;
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.3s ease;
      }

      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: #667eea;
      }

      .btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 12px 30px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.3s ease;
      }

      .btn:hover {
        transform: translateY(-2px);
      }

      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      .results {
        margin-top: 30px;
      }

      .material-card {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 15px;
      }

      .material-card h3 {
        color: #667eea;
        margin-bottom: 10px;
      }

      .material-info {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 10px;
        margin-top: 15px;
      }

      .info-item {
        background: white;
        padding: 10px;
        border-radius: 5px;
        border-left: 4px solid #667eea;
      }

      .info-item strong {
        color: #555;
      }

      .confidence-high {
        border-left-color: #28a745;
      }
      .confidence-medium {
        border-left-color: #ffc107;
      }
      .confidence-low {
        border-left-color: #dc3545;
      }

      .loading {
        text-align: center;
        padding: 20px;
      }

      .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #667eea;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
      }

      .stat-number {
        font-size: 2rem;
        font-weight: bold;
        margin-bottom: 5px;
      }

      .tabs {
        display: flex;
        margin-bottom: 30px;
        background: white;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .tab {
        flex: 1;
        padding: 15px 20px;
        background: #f8f9fa;
        border: none;
        cursor: pointer;
        font-size: 16px;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .tab.active {
        background: #667eea;
        color: white;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .quote-result {
        background: #e8f5e8;
        border: 2px solid #28a745;
        border-radius: 10px;
        padding: 25px;
        margin-top: 20px;
      }

      .quote-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .quote-total {
        font-size: 2rem;
        font-weight: bold;
        color: #28a745;
      }

      .task-item {
        background: white;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
        border-left: 4px solid #667eea;
      }

      .error {
        background: #f8d7da;
        color: #721c24;
        padding: 15px;
        border-radius: 8px;
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üèóÔ∏è Donizo Semantic Pricing Engine</h1>
        <p>
          The pricing intelligence that powers the global renovation economy
        </p>
        <div
          style="
            background: rgba(255, 107, 107, 0.2);
            border: 1px solid rgba(255, 107, 107, 0.5);
            border-radius: 8px;
            padding: 10px;
            margin-top: 15px;
            font-size: 0.9em;
          "
        >
          <strong>‚ö†Ô∏è Demo System:</strong> This is a demonstration of the
          semantic pricing engine. Vendor links may be blocked due to
          geo-restrictions or bot protection. In production, these would link to
          actual product pages.
        </div>
      </div>

      <div class="tabs">
        <button class="tab active" onclick="showTab('search')">
          üîç Material Search
        </button>
        <button class="tab" onclick="showTab('quote')">
          üí∞ Quote Generator
        </button>
        <button class="tab" onclick="showTab('feedback')">üìù Feedback</button>
        <button class="tab" onclick="showTab('stats')">üìä Statistics</button>
      </div>

      <!-- Material Search Tab -->
      <div id="search" class="tab-content active">
        <div class="card">
          <h2>üîç Semantic Material Search</h2>
          <p>
            Search for materials using natural language - try fuzzy queries like
            "waterproof glue for bathroom tiles"
          </p>

          <form onsubmit="searchMaterials(event)">
            <div class="form-group">
              <label for="searchQuery">Search Query</label>
              <input
                type="text"
                id="searchQuery"
                placeholder="e.g., waterproof adhesive for shower tiles, not cheap"
                required
              />
            </div>

            <div
              style="
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
              "
            >
              <div class="form-group">
                <label for="region">Region (Optional)</label>
                <select id="region">
                  <option value="">All Regions</option>
                  <option value="√éle-de-France">√éle-de-France (Paris)</option>
                  <option value="Provence-Alpes-C√¥te d'Azur">
                    Provence-Alpes-C√¥te d'Azur
                  </option>
                  <option value="Nouvelle-Aquitaine">Nouvelle-Aquitaine</option>
                  <option value="Occitanie">Occitanie</option>
                  <option value="Hauts-de-France">Hauts-de-France</option>
                  <option value="Belgium">Belgium</option>
                  <option value="Luxembourg">Luxembourg</option>
                </select>
              </div>

              <div class="form-group">
                <label for="qualityMin">Min Quality (1-5)</label>
                <select id="qualityMin">
                  <option value="">Any Quality</option>
                  <option value="1">1 - Basic</option>
                  <option value="2">2 - Standard</option>
                  <option value="3">3 - Good</option>
                  <option value="4">4 - High</option>
                  <option value="5">5 - Premium</option>
                </select>
              </div>

              <div class="form-group">
                <label for="limit">Max Results</label>
                <select id="limit">
                  <option value="5">5 results</option>
                  <option value="10">10 results</option>
                  <option value="15">15 results</option>
                </select>
              </div>
            </div>

            <button type="submit" class="btn">üîç Search Materials</button>
          </form>

          <div id="searchResults" class="results"></div>
        </div>
      </div>

      <!-- Quote Generator Tab -->
      <div id="quote" class="tab-content">
        <div class="card">
          <h2>üí∞ Quote Generator</h2>
          <p>
            Generate comprehensive renovation quotes from natural language
            descriptions
          </p>

          <form onsubmit="generateQuote(event)">
            <div class="form-group">
              <label for="transcript">Project Description</label>
              <textarea
                id="transcript"
                rows="4"
                placeholder="e.g., Need waterproof glue and 60x60cm matte white wall tiles for bathroom renovation in Paris. High quality materials only."
                required
              ></textarea>
            </div>

            <div class="form-group">
              <label for="quoteRegion">Region</label>
              <select id="quoteRegion" required>
                <option value="√éle-de-France">
                  √éle-de-France (Paris) +15%
                </option>
                <option value="Provence-Alpes-C√¥te d'Azur">
                  Provence-Alpes-C√¥te d'Azur +8%
                </option>
                <option value="Nouvelle-Aquitaine">Nouvelle-Aquitaine</option>
                <option value="Occitanie">Occitanie</option>
                <option value="Hauts-de-France">Hauts-de-France</option>
                <option value="Belgium">Belgium +12%</option>
                <option value="Luxembourg">Luxembourg +20%</option>
              </select>
            </div>

            <button type="submit" class="btn">üí∞ Generate Quote</button>
          </form>

          <div id="quoteResults" class="results"></div>
        </div>
      </div>

      <!-- Feedback Tab -->
      <div id="feedback" class="tab-content">
        <div class="card">
          <h2>üìù Submit Feedback</h2>
          <p>Help improve the system by providing feedback on quotes</p>

          <form onsubmit="submitFeedback(event)">
            <div class="form-group">
              <label for="quoteId">Quote ID</label>
              <input
                type="text"
                id="quoteId"
                placeholder="Enter quote ID from generated quote"
                required
              />
            </div>

            <div
              style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px"
            >
              <div class="form-group">
                <label for="userType">User Type</label>
                <select id="userType" required>
                  <option value="contractor">Contractor</option>
                  <option value="client">Client</option>
                  <option value="supplier">Supplier</option>
                </select>
              </div>

              <div class="form-group">
                <label for="verdict">Verdict</label>
                <select id="verdict" required>
                  <option value="accurate">Accurate</option>
                  <option value="overpriced">Overpriced</option>
                  <option value="underpriced">Underpriced</option>
                  <option value="wrong_material">Wrong Material</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="comment">Comment</label>
              <textarea
                id="comment"
                rows="3"
                placeholder="Please provide specific feedback..."
                required
              ></textarea>
            </div>

            <button type="submit" class="btn">üìù Submit Feedback</button>
          </form>

          <div id="feedbackResults" class="results"></div>
        </div>
      </div>

      <!-- Statistics Tab -->
      <div id="stats" class="tab-content">
        <div class="card">
          <h2>üìä System Statistics</h2>
          <button onclick="loadStats()" class="btn">üîÑ Refresh Stats</button>
          <div id="statsResults" class="results"></div>
        </div>
      </div>
    </div>

    <script>
      const API_BASE = "http://localhost:8000";

      function showTab(tabName) {
        // Hide all tab contents
        document.querySelectorAll(".tab-content").forEach((content) => {
          content.classList.remove("active");
        });

        // Remove active class from all tabs
        document.querySelectorAll(".tab").forEach((tab) => {
          tab.classList.remove("active");
        });

        // Show selected tab content
        document.getElementById(tabName).classList.add("active");

        // Add active class to clicked tab
        event.target.classList.add("active");
      }

      async function searchMaterials(event) {
        event.preventDefault();

        const query = document.getElementById("searchQuery").value;
        const region = document.getElementById("region").value;
        const qualityMin = document.getElementById("qualityMin").value;
        const limit = document.getElementById("limit").value;

        const resultsDiv = document.getElementById("searchResults");
        resultsDiv.innerHTML =
          '<div class="loading"><div class="spinner"></div><p>Searching materials...</p></div>';

        try {
          const params = new URLSearchParams({ query, limit });
          if (region) params.append("region", region);
          if (qualityMin) params.append("quality_min", qualityMin);

          console.log(
            "Searching with URL:",
            `${API_BASE}/material-price?${params}`
          );

          const response = await fetch(`${API_BASE}/material-price?${params}`);
          const data = await response.json();

          console.log("Search response:", response.status, data);

          if (response.ok) {
            displaySearchResults(data);
          } else {
            console.error("Search error:", data);
            resultsDiv.innerHTML = `<div class="error">Error: ${
              data.detail?.message || data.detail || "Search failed"
            }</div>`;
          }
        } catch (error) {
          console.error("Network error:", error);
          resultsDiv.innerHTML = `<div class="error">Network error: ${error.message}</div>`;
        }
      }

      function displaySearchResults(materials) {
        const resultsDiv = document.getElementById("searchResults");

        console.log("Displaying results:", materials);

        if (!materials || materials.length === 0) {
          resultsDiv.innerHTML =
            "<p>No materials found. Try broader search terms.</p>";
          return;
        }

        let html = `<h3>Found ${materials.length} materials:</h3>`;

        materials.forEach((material, index) => {
          console.log("Processing material:", material);
          const confidenceClass = `confidence-${(
            material.confidence_tier || "LOW"
          ).toLowerCase()}`;
          html += `
                    <div class="material-card">
                        <h3>${material.material_name}</h3>
                        <p><strong>Description:</strong> ${
                          material.description
                        }</p>
                        
                        <div class="material-info">
                            <div class="info-item">
                                <strong>Price:</strong> ‚Ç¨${
                                  material.unit_price
                                } ${material.unit}
                            </div>
                            <div class="info-item">
                                <strong>Region:</strong> ${material.region}
                            </div>
                            <div class="info-item ${confidenceClass}">
                                <strong>Confidence:</strong> ${
                                  material.confidence_tier || "LOW"
                                } (${(
            (material.similarity_score || 0) * 100
          ).toFixed(1)}%)
                            </div>
                            ${
                              material.vendor
                                ? `<div class="info-item"><strong>Vendor:</strong> ${material.vendor}</div>`
                                : ""
                            }
                            ${
                              material.quality_score
                                ? `<div class="info-item"><strong>Quality:</strong> ${material.quality_score}/5</div>`
                                : ""
                            }
                        </div>
                        
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
                            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                                <div style="font-size: 0.9em; color: #666;">
                                    <div><strong>Source:</strong> <a href="${getWorkingUrl(
                                      material.vendor
                                    )}" target="_blank" style="color: #667eea; text-decoration: none;">${
            material.vendor
          } Official Site</a> 
          <br><span style="color: #ff6b6b; font-size: 0.8em;">‚ö†Ô∏è Demo system - Real vendor sites may have geo-blocking</span>
          </div>
                                    <div><strong>Updated:</strong> ${new Date(
                                      material.updated_at
                                    ).toLocaleDateString()}</div>
                                </div>
                                <div style="display: flex; gap: 8px;">
                                    <button onclick="viewProductDetails('${
                                      material.material_name
                                    }', '${material.vendor}')" 
                                            style="background: #667eea; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; font-size: 0.8em;">
                                        üìã Details
                                    </button>
                                    <a href="${getWorkingUrl(
                                      material.vendor
                                    )}" target="_blank" 
                                       style="background: #28a745; color: white; border: none; padding: 8px 12px; border-radius: 5px; text-decoration: none; font-size: 0.8em; display: inline-block;">
                                        üîó Visit Store
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
        });

        try {
          resultsDiv.innerHTML = html;
          console.log("HTML set successfully");
        } catch (error) {
          console.error("Error setting HTML:", error);
          resultsDiv.innerHTML =
            "<div class='error'>Error displaying results. Check console.</div>";
        }
      }

      async function generateQuote(event) {
        event.preventDefault();

        const transcript = document.getElementById("transcript").value;
        const region = document.getElementById("quoteRegion").value;

        const resultsDiv = document.getElementById("quoteResults");
        resultsDiv.innerHTML =
          '<div class="loading"><div class="spinner"></div><p>Generating quote...</p></div>';

        try {
          const response = await fetch(`${API_BASE}/generate-proposal`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ transcript, region }),
          });

          const data = await response.json();

          if (response.ok) {
            displayQuoteResults(data);
          } else {
            resultsDiv.innerHTML = `<div class="error">Error: ${
              data.detail || "Quote generation failed"
            }</div>`;
          }
        } catch (error) {
          resultsDiv.innerHTML = `<div class="error">Network error: ${error.message}</div>`;
        }
      }

      function displayQuoteResults(quote) {
        const resultsDiv = document.getElementById("quoteResults");

        // Get the region from the form since it's not returned in the quote
        const selectedRegion = document.getElementById("quoteRegion").value;

        let tasksHtml = "";
        quote.tasks.forEach((task) => {
          let materialsHtml = "";
          if (task.materials && task.materials.length > 0) {
            task.materials.forEach((material) => {
              materialsHtml += `
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin: 5px 0;">
                            <strong>${material.material_name}</strong><br>
                            Price: ‚Ç¨${material.unit_price} ${material.unit}
                        </div>
                    `;
            });
          } else {
            materialsHtml = `
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin: 5px 0; color: #666;">
                            <em>Estimated materials cost included in total</em>
                        </div>
                    `;
          }

          tasksHtml += `
                    <div class="task-item">
                        <h4>${task.label}</h4>
                        <p><strong>Duration:</strong> ${
                          task.estimated_duration
                        } (${task.labor_hours}h labor)</p>
                        <p><strong>Labor Cost:</strong> ‚Ç¨${task.labor_cost}</p>
                        <p><strong>Total Price:</strong> ‚Ç¨${
                          task.margin_protected_price
                        }</p>
                        <p><strong>Confidence:</strong> ${(
                          task.confidence_score * 100
                        ).toFixed(1)}%</p>
                        <div style="margin-top: 10px;">
                            <strong>Materials:</strong>
                            ${materialsHtml}
                        </div>
                    </div>
                `;
        });

        resultsDiv.innerHTML = `
                <div class="quote-result">
                    <div class="quote-header">
                        <div>
                            <h3>Quote Generated Successfully!</h3>
                            <p><strong>Quote ID:</strong> ${quote.quote_id}</p>
                            <p><strong>Region:</strong> ${selectedRegion}</p>
                            <p><strong>VAT Rate:</strong> ${(
                              quote.vat_rate * 100
                            ).toFixed(0)}%</p>
                            <p><strong>Margin Rate:</strong> ${(
                              quote.margin_rate * 100
                            ).toFixed(0)}%</p>
                        </div>
                        <div class="quote-total">‚Ç¨${quote.total_estimate}</div>
                    </div>
                    
                    <div>
                        <p><strong>Overall Confidence:</strong> ${(
                          quote.confidence_score * 100
                        ).toFixed(1)}%</p>
                        <p><strong>Estimated Duration:</strong> ${
                          quote.estimated_duration
                        }</p>
                    </div>
                    
                    <h4 style="margin-top: 20px;">Tasks Breakdown:</h4>
                    ${tasksHtml}
                </div>
            `;
      }

      async function submitFeedback(event) {
        event.preventDefault();

        const quoteId = document.getElementById("quoteId").value;
        const userType = document.getElementById("userType").value;
        const verdict = document.getElementById("verdict").value;
        const comment = document.getElementById("comment").value;

        const resultsDiv = document.getElementById("feedbackResults");
        resultsDiv.innerHTML =
          '<div class="loading"><div class="spinner"></div><p>Submitting feedback...</p></div>';

        try {
          const response = await fetch(`${API_BASE}/feedback`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              quote_id: quoteId,
              user_type: userType,
              verdict,
              comment,
            }),
          });

          const data = await response.json();

          if (response.ok) {
            let adaptationsHtml = "";
            if (data.system_adaptations && data.system_adaptations.length > 0) {
              data.system_adaptations.forEach((adaptation) => {
                adaptationsHtml += `<li>${adaptation}</li>`;
              });
            }

            let confidenceHtml = "";
            if (
              data.confidence_adjustments &&
              data.confidence_adjustments.length > 0
            ) {
              data.confidence_adjustments.forEach((adjustment) => {
                confidenceHtml += `<li>${adjustment}</li>`;
              });
            }

            let learningHtml = "";
            if (data.learning_impact) {
              Object.entries(data.learning_impact).forEach(([key, value]) => {
                learningHtml += `<li><strong>${key.replace(
                  "_",
                  " "
                )}:</strong> ${value}</li>`;
              });
            }

            resultsDiv.innerHTML = `
                        <div style="background: #d4edda; border: 2px solid #28a745; border-radius: 10px; padding: 20px; margin-top: 20px;">
                            <h3>‚úÖ Feedback Submitted Successfully!</h3>
                            <p><strong>Feedback ID:</strong> ${data.feedback_id}</p>
                            <p><strong>Status:</strong> ${data.status}</p>
                            
                            <h4>Learning Impact:</h4>
                            <ul>${learningHtml}</ul>
                            
                            <h4>System Adaptations:</h4>
                            <ul>${adaptationsHtml}</ul>
                            
                            <h4>Confidence Adjustments:</h4>
                            <ul>${confidenceHtml}</ul>
                        </div>
                    `;

            // Clear form
            document.getElementById("quoteId").value = "";
            document.getElementById("comment").value = "";
          } else {
            resultsDiv.innerHTML = `<div class="error">Error: ${
              data.detail || "Feedback submission failed"
            }</div>`;
          }
        } catch (error) {
          resultsDiv.innerHTML = `<div class="error">Network error: ${error.message}</div>`;
        }
      }

      async function loadStats() {
        const resultsDiv = document.getElementById("statsResults");
        resultsDiv.innerHTML =
          '<div class="loading"><div class="spinner"></div><p>Loading statistics...</p></div>';

        try {
          const response = await fetch(`${API_BASE}/stats`);
          const data = await response.json();

          if (response.ok) {
            let categoriesHtml = "";
            Object.entries(data.materials.by_category)
              .slice(0, 5)
              .forEach(([category, count]) => {
                categoriesHtml += `<li>${category}: ${count} materials</li>`;
              });

            let regionsHtml = "";
            Object.entries(data.materials.by_region)
              .slice(0, 5)
              .forEach(([region, count]) => {
                regionsHtml += `<li>${region}: ${count} materials</li>`;
              });

            resultsDiv.innerHTML = `
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-number">${
                                  data.materials.total
                                }</div>
                                <div>Total Materials</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">‚Ç¨${
                                  data.materials.total_value
                                    ? data.materials.total_value.toFixed(0)
                                    : "0"
                                }</div>
                                <div>Total Material Value</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">${
                                  data.materials.average_price
                                    ? data.materials.average_price.toFixed(2)
                                    : "0"
                                }</div>
                                <div>Average Price (‚Ç¨)</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">${
                                  data.materials.average_quality
                                    ? data.materials.average_quality.toFixed(1)
                                    : "0"
                                }</div>
                                <div>Average Quality</div>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 30px;">
                            <div>
                                <h4>Top Categories:</h4>
                                <ul style="margin-top: 10px;">${categoriesHtml}</ul>
                            </div>
                            <div>
                                <h4>Top Regions:</h4>
                                <ul style="margin-top: 10px;">${regionsHtml}</ul>
                            </div>
                        </div>
                        
                        <div style="background: #f8f9fa; border-radius: 10px; padding: 20px; margin-top: 30px;">
                            <h4>System Information:</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                                <div><strong>Embedding Model:</strong> ${
                                  data.system.embedding_model
                                }</div>
                                <div><strong>Vector Dimension:</strong> ${
                                  data.system.vector_dimension
                                }D</div>
                                <div><strong>OpenAI Available:</strong> ${
                                  data.system.openai_available
                                    ? "‚úÖ Yes"
                                    : "‚ùå No"
                                }</div>
                                <div><strong>Database:</strong> ${
                                  data.system.database
                                }</div>
                            </div>
                        </div>
                    `;
          } else {
            resultsDiv.innerHTML = `<div class="error">Error loading statistics</div>`;
          }
        } catch (error) {
          resultsDiv.innerHTML = `<div class="error">Network error: ${error.message}</div>`;
        }
      }

      // Get working URL for vendor
      function getWorkingUrl(vendor) {
        const vendorUrls = {
          "Point P": "https://www.pointp.fr",
          "Saint-Gobain": "https://www.saint-gobain.fr",
          "Mr. Bricolage": "https://www.mr.bricolage.fr",
          BigMat: "https://www.bigmat.fr",
          "Leroy Merlin": "https://www.leroymerlin.fr",
          Castorama: "https://www.castorama.fr",
          Gedimat: "https://www.gedimat.fr",
          Mapei: "https://www.mapei.com/fr",
          Sika: "https://fra.sika.com",
          Weber: "https://www.weber.fr",
        };
        return (
          vendorUrls[vendor] ||
          "https://www.google.com/search?q=" +
            encodeURIComponent(vendor + " mat√©riaux construction")
        );
      }

      // Product details function
      function viewProductDetails(productName, vendor) {
        alert(
          `üìã Product Details\n\n` +
            `Product: ${productName}\n` +
            `Vendor: ${vendor}\n\n` +
            `‚ÑπÔ∏è In a real system, this would:\n` +
            `‚Ä¢ Open detailed product specifications\n` +
            `‚Ä¢ Show installation guides\n` +
            `‚Ä¢ Display customer reviews\n` +
            `‚Ä¢ Provide vendor contact info\n` +
            `‚Ä¢ Show availability and delivery options`
        );
      }

      // Load stats on page load
      document.addEventListener("DOMContentLoaded", function () {
        // Set example queries
        document.getElementById("searchQuery").value =
          "waterproof adhesive for bathroom tiles";
        document.getElementById("transcript").value =
          "Need waterproof glue and 60x60cm matte white wall tiles for bathroom renovation in Paris. High quality materials only.";
      });
    </script>
  </body>
</html>
